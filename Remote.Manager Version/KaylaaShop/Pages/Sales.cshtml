@page
@model KaylaaShop.Pages.Kaylaa.SalesModel

@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration

@{
    ViewData["Title"] = "Sales";
    Layout = "~/Pages/Shared/_LayoutMain.cshtml";
}





<div class="row">
    <div class="col-xl-12">
        <div class="kt-portlet kt-portlet--mobile">
            <div class="kt-portlet__head kt-portlet__head--lg deepBlueBack">
                <div class="kt-portlet__head-label">
                    <span class="kt-portlet__head-icon">
                        <i class="flaticon-calendar"></i>
                    </span>
                    <h3 class="kt-portlet__head-title kt-font-primary whiteFont">
                        Sales Management
                    </h3>
                </div>
                <div class="kt-portlet__head-toolbar">

                    <div class="kt-portlet__head-toolbar">

                       
                    </div>


                    <div class="kt-portlet__head-actions kt-header__topbar">

                        <input id="serverUrl" type="hidden" value="@Configuration.GetSection("ServerRoot")["HostUrl"]" />

                        <!--begin: Search -->
                        <div class="kt-header__topbar-item kt-header__topbar-item--search dropdown" id="kt_quick_search_toggle">
                            <div class="kt-header__topbar-wrapper" data-toggle="dropdown" data-offset="10px,0px">
                                <a>
                                    <span class="whiteFont mr-4">
                                        Find Product with Barcode
                                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" class="kt-svg-icon">
                                            <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                <rect id="bound" x="0" y="0" width="24" height="24" />
                                                <path d="M14.2928932,16.7071068 C13.9023689,16.3165825 13.9023689,15.6834175 14.2928932,15.2928932 C14.6834175,14.9023689 15.3165825,14.9023689 15.7071068,15.2928932 L19.7071068,19.2928932 C20.0976311,19.6834175 20.0976311,20.3165825 19.7071068,20.7071068 C19.3165825,21.0976311 18.6834175,21.0976311 18.2928932,20.7071068 L14.2928932,16.7071068 Z" id="Path-2" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                <path d="M11,16 C13.7614237,16 16,13.7614237 16,11 C16,8.23857625 13.7614237,6 11,6 C8.23857625,6 6,8.23857625 6,11 C6,13.7614237 8.23857625,16 11,16 Z M11,18 C7.13400675,18 4,14.8659932 4,11 C4,7.13400675 7.13400675,4 11,4 C14.8659932,4 18,7.13400675 18,11 C18,14.8659932 14.8659932,18 11,18 Z" id="Path" fill="#000000" fill-rule="nonzero" />
                                            </g>
                                        </svg>
                                    </span>
                                </a>
                            </div>
                            <div class="dropdown-menu dropdown-menu-fit dropdown-menu-right dropdown-menu-anim dropdown-menu-lg">
                                <div class="kt-quick-search kt-quick-search--inline" id="kt_quick_search_inline">
                                    <form method="post" class="kt-quick-search__form">
                                        <div class="input-group">
                                            <div class="input-group-prepend"><span class="input-group-text"><i class="flaticon2-search-1"></i></span></div>
                                             <input name="prodCode" type="text" class="form-control kt-quick-search__input" placeholder="Product Code">
                                             <input name="qty" class="float-right w-25 mr-1 ml-1" type="text" value="1" />
                                            <button class="btn btn-primary deepBlueBack whiteFont btn-sm" asp-page-handler="FindProduct" type="submit"> Add to Cart </button>
                                            <div class="input-group-append"><span class="input-group-text"><i class="la la-close kt-quick-search__close"></i></span></div>
                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>
                        <!--end: Search -->
                        <!--begin: My Cart -->
                        <div class="kt-header__topbar-item">
                            <div class="kt-header__topbar-wrapper" data-toggle="" data-offset="30px,0px" aria-expanded="true">
                                <a asp-page="ShoppingCart" class="whiteFont">

                                    View Cart
                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1" class="kt-svg-icon">
                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <rect id="bound" x="0" y="0" width="24" height="24" />
                                            <path d="M12,4.56204994 L7.76822128,9.6401844 C7.4146572,10.0644613 6.7840925,10.1217854 6.3598156,9.76822128 C5.9355387,9.4146572 5.87821464,8.7840925 6.23177872,8.3598156 L11.2317787,2.3598156 C11.6315738,1.88006147 12.3684262,1.88006147 12.7682213,2.3598156 L17.7682213,8.3598156 C18.1217854,8.7840925 18.0644613,9.4146572 17.6401844,9.76822128 C17.2159075,10.1217854 16.5853428,10.0644613 16.2317787,9.6401844 L12,4.56204994 Z" id="Path-30" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                            <path d="M3.5,9 L20.5,9 C21.0522847,9 21.5,9.44771525 21.5,10 C21.5,10.132026 21.4738562,10.2627452 21.4230769,10.3846154 L17.7692308,19.1538462 C17.3034221,20.271787 16.2111026,21 15,21 L9,21 C7.78889745,21 6.6965779,20.271787 6.23076923,19.1538462 L2.57692308,10.3846154 C2.36450587,9.87481408 2.60558331,9.28934029 3.11538462,9.07692308 C3.23725479,9.02614384 3.36797398,9 3.5,9 Z M12,17 C13.1045695,17 14,16.1045695 14,15 C14,13.8954305 13.1045695,13 12,13 C10.8954305,13 10,13.8954305 10,15 C10,16.1045695 10.8954305,17 12,17 Z" id="Combined-Shape" fill="#000000" />
                                        </g>
                                    </svg>

                                </a>

                            </div>
                        </div>
                        <!--end: My Cart --><!--begin: Quick panel toggler -->
                    </div>
                </div>
            </div>
            <div class="kt-portlet__body">

                <form class="form-inline border-bottom mb-4 p-2" method="post">
                    <div class="mb-2">
                        <select asp-for="shopId" asp-items="Model.allShops" style="padding:10px;width:150px;" class="form-control purplefont mr-2">
                            <option value="0">Select Shop</option>
                        </select>
                    </div>

                    <button type="submit" asp-page="Sales" asp-page-handler="SetCurrentShop" class="btn  purpleback mr-4"> View Shop Products </button>

                </form>
             
                <div class="row">

                    @if (ViewData["status"] != null)
                    {
                        <div class="col-md-12 alert alert-danger" role="alert">
                            @ViewData["status"]
                        </div>
                    }

                </div>
                <div class="row">

                    @if (Model.ProductList.Count >= 1)
                    {
                        @foreach (var prod in Model.ProductList)
                        {
                            <div class="col-lg-4 col-md-6 mb-4">
                                <div class="card h-100">
                                    <a href="#"><img class="card-img-top" src="@prod.productImageUrl" alt=""></a>
                                    <form method="post">
                                        <div class="card-body">
                                            <h4 class="card-title">
                                                <a href="#">@prod.Name </a>

                                            </h4>
                                            <p class="card-text">@prod.prodCode </p>
                                            <h5> Price <span class="content"> ₦ @string.Format("{0:N0}", @prod.NormalSellingPrice)</span></h5>

                                            <p class="card-text"> Available In Stock <span class="content"> @prod.quantityAvailable </span></p>

                                            <p class="card-text"> Quantity To Buy  <span> <input name="qty" class="float-right w-25" type="text" value="1" />  </span> </p>
                                            <input type="hidden" name="prodId" value="@prod.Id" />

                                        </div>
                                        <div class="card-footer clearfix pb-2">
                                            <small class="text-muted float-left"> <button asp-page="Sales" type="submit" class="btn btn-sm btn-primary deepBlueBack whiteFont"> Add To Basket</button></small>
                                            <small class="text-muted float-right"> <a asp-page="./ViewProduct" asp-route-productid="@prod.Id" class="btn btn-sm btn-primary deepBlueBack whiteFont">View</a></small>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        }
                    }
                    else
                    {

                        @*<div class="col-lg-12 alert alert-danger">

                            <p> <strong> @ViewData["status"] </strong> </p>
                        </div>*@
                    }

                </div>

                <div class="row">

                    <div class="col-lg-6">

                        @{
                            var prevDisabled = !Model.ProductList.HasPreviousPage ? "disabled" : "";
                            var nextDisabled = !Model.ProductList.HasNextPage ? "disabled" : "";

                            <a asp-page="./Sales"
                               asp-route-pageIndex="@(Model.ProductList.PageIndex - 1)"
                               class="mr-4 btn btn-default  @prevDisabled">
                                Previous
                            </a>
                            <a asp-page="./Sales"
                               asp-route-pageIndex="@(Model.ProductList.PageIndex + 1)"
                               class="btn btn-default @nextDisabled">
                                Next
                            </a>


                        }

                    </div>

                    <div class="col-lg-6">
                        <p class="float-right">
                            Total Products
                            <a class="btn btn-default ml-4">
                                @Model.totalProduct
                            </a>
                        </p>
                    </div>

                </div>
                <!--begin: Datatable -->
                <!--end: Datatable -->
            </div>
        </div>

    </div>

</div>




@section Scripts
{
    <environment include="Development">
        <script src="~/library/datatables.net/js/jquery.dataTables.js"></script>
        <script src="~/library/datatables.net-bs4/js/dataTables.bootstrap4.js"></script>
        <link href="~/library/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet" />
    </environment>

    <environment exclude="Development">
        <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
        <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js" type="text/javascript"></script>
    </environment>

    <script>
        var ServerRoot = $("#serverUrl").val();
    </script>

}


